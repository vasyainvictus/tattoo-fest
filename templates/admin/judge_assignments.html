{% extends "base.html" %}

{% block title %}Назначение судей: {{ nomination.name }}{% endblock %}

{% block content %}
<div style="max-width: 900px; margin: 30px auto; padding: 20px;">
    <a href="{{ url_for('admin.manage_nominations') }}" style="color: #6c757d; text-decoration: none; display: inline-block; margin-bottom: 10px;">← Назад к списку номинаций</a>
    
    <!-- ИЗМЕНЕНИЕ: Заголовок стал более информативным -->
    <h1>Назначение судей</h1>
    <h4 style="color: #6c757d; margin-top: -10px;">
        Номинация: <strong>{{ nomination.name }} ({{ CATEGORY_MAP.get(nomination.category, nomination.category) }})</strong> | 
        День: <strong>{{ nomination.event_day.date.strftime('%d.%m.%Y') }}</strong>
    </h4>
    <hr>
    
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div style="padding: 10px; margin-bottom: 15px; border-radius: 5px; color: {% if category == 'error' %}#721c24{% else %}#155724{% endif %}; background-color: {% if category == 'error' %}#f8d7da{% else %}#d4edda{% endif %};">
                    {{ message }}
                </div>
            {% endfor %}
        {% endif %}
    {% endwith %}

    <div style="background-color: #f8f9fa; padding: 20px; border-radius: 5px; margin-bottom: 30px;">
        <h4>Назначить нового судью</h4>
        {% if available_judges %}
            <form method="POST" action="{{ url_for('admin.assign_judge', nomination_id=nomination.id) }}">
                <div style="display: flex; gap: 15px; align-items: flex-end;">
                    <div style="flex-grow: 1;">
                        <label for="judge_id">Выберите судью:</label>
                        <select id="judge_id" name="judge_id" required style="width: 100%; padding: 8px;">
                            <option value="" disabled selected>-- Доступные судьи --</option>
                            {% for judge in available_judges %}
                                <option value="{{ judge.id }}">{{ judge.code }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <button type="submit" style="padding: 8px 15px; background-color: #28a745; color: white; border: none; border-radius: 5px; cursor: pointer;">Назначить</button>
                </div>
            </form>
        {% else %}
            <p style="color: #6c757d;">Все доступные судьи уже назначены на эту номинацию, либо судьи не созданы в системе.</p>
        {% endif %}
    </div>

    <!-- ИЗМЕНЕНИЕ: Удалено упоминание max_judges -->
    <h4>Назначенные судьи ({{ assignments|length }})</h4>
    <table style="width: 100%; border-collapse: collapse;">
        <thead>
            <tr style="background-color: #e9ecef;">
                <th style="padding: 10px; text-align: left;">Код судьи</th>
                <th style="padding: 10px; text-align: center; width: 20%;">Действия</th>
            </tr>
        </thead>
        <tbody>
            {% for assignment in assignments %}
            <tr>
                <td style="padding: 10px; border-bottom: 1px solid #dee2e6;"><strong>{{ assignment.judge.code }}</strong></td>
                <td style="padding: 10px; border-bottom: 1px solid #dee2e6; text-align: center;">
                    <form method="POST" action="{{ url_for('admin.unassign_judge', assignment_id=assignment.id) }}" onsubmit="return confirm('Снять судью {{ assignment.judge.code }} с этой номинации?');">
                        <button type="submit" style="background: none; border: none; color: #dc3545; cursor: pointer; text-decoration: underline;">
                            Снять с номинации
                        </button>
                    </form>
                </td>
            </tr>
            {% else %}
            <tr>
                <td colspan="2" style="text-align: center; padding: 15px;">Судьи еще не назначены.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}